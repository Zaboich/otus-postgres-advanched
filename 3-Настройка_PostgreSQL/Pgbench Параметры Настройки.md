### USER
–†–∞—Å—Å–∫–∞–∂–∏ –æ pgbench. –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è?

### ASSISTANT
## pgbench ‚Äî —É—Ç–∏–ª–∏—Ç–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è PostgreSQL

**pgbench** ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ PostgreSQL –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤ –∏ –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –°–£–ë–î. –û–Ω–∞ —ç–º—É–ª–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤, –≤—ã–ø–æ–ª–Ω—è—è –∑–∞–¥–∞–Ω–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≥–ª–∞–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º **TPS (Transactions Per Second)** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É .

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

–£—Ç–∏–ª–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (`-i`)** ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—É—é –ë–î —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø–æ —Å—Ö–µ–º–µ TPC-B:
   ```bash
   pgbench -i -s 10 mydb
   ```
   * `-s` ‚Äî –º–∞—Å—à—Ç–∞–±–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å (scale factor). –ü—Ä–∏ `-s 10` —Å–æ–∑–¥–∞—ë—Ç—Å—è ~1 –º–ª–Ω —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ `pgbench_accounts`.

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∑–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–∫–∏:
   ```bash
   pgbench -c 16 -j 4 -T 60 mydb
   ```

---

### ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|--------|
| `-c N` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π | `-c 32` |
| `-j N` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â§ `-c`) | `-j 8` |
| `-T N` | –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö | `-T 300` |
| `-t N` | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ | `-t 10000` |
| `-s N` | –ú–∞—Å—à—Ç–∞–±–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ | `-s 50` |
| `-r` | –í—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | `-r` |
| `-P N` | –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –≤—ã–≤–æ–¥–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—Å–µ–∫) | `-P 10` |
| `-M querymode` | –†–µ–∂–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: `simple`, `extended`, `prepared` | `-M prepared` |
| `-R rate` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π/—Å–µ–∫ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞) | `-R 100` |
| `-f script` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –≤–º–µ—Å—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ | `-f custom.sql` |
| `--latency-limit=N` | –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ø—Ä–µ–≤—ã—à–∞—é—â–∏—Ö –ª–∏–º–∏—Ç (–º—Å) | `--latency-limit=100` |
| `--rate=N` | –¶–µ–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (TPS) | `--rate=1000` |
| `--progress-timestamp` | –í—ã–≤–æ–¥ timestamps –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å-–æ—Ç—á—ë—Ç–∞—Ö | `--progress-timestamp` |

---

### üìä –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (TPC-B –ø–æ–¥–æ–±–Ω—ã–π)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é pgbench –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–π –±–∞–Ω–∫–æ–≤—Å–∫—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:

```sql
BEGIN;
UPDATE pgbench_accounts SET abalance = abalance + :delta WHERE aid = :aid;
SELECT abalance FROM pgbench_accounts WHERE aid = :aid;
UPDATE pgbench_tellers SET tbalance = tbalance + :delta WHERE tid = :tid;
UPDATE pgbench_branches SET bbalance = bbalance + :delta WHERE bid = :bid;
INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES (:tid, :bid, :aid, :delta, CURRENT_TIMESTAMP);
END;
```

–°—Ö–µ–º–∞ –ë–î –≤–∫–ª—é—á–∞–µ—Ç 4 —Ç–∞–±–ª–∏—Ü—ã:
- `pgbench_branches` (—Ñ–∏–ª–∏–∞–ª—ã)
- `pgbench_tellers` (–∫–∞—Å—Å–∏—Ä—ã)
- `pgbench_accounts` (—Å—á–µ—Ç–∞) ‚Äî —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è —Ç–∞–±–ª–∏—Ü–∞
- `pgbench_history` (–∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π)

---

### ‚úçÔ∏è –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞–≥—Ä—É–∑–∫–∏:

```sql
-- custom.sql
\set aid random(1, 100000 * :scale)
BEGIN;
SELECT abalance FROM pgbench_accounts WHERE aid = :aid;
UPDATE pgbench_accounts SET abalance = abalance + 100 WHERE aid = :aid;
COMMIT;
```

–ó–∞–ø—É—Å–∫:
```bash
pgbench -c 16 -j 4 -T 60 -f custom.sql mydb
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`:scale`, `:client_id`), —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (`random()`, `uniform()`, `gaussian()`), –∏ —É—Å–ª–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

---

### üìà –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–¢–∏–ø–∏—á–Ω—ã–π –≤—ã–≤–æ–¥:
```
transaction type: <builtin: TPC-B (sort of)>
scaling factor: 10
query mode: simple
number of clients: 16
number of threads: 4
duration: 60 s
number of transactions actually processed: 245678
latency average = 3.912 ms
latency stddev = 1.245 ms
initial connection time = 12.5 ms
tps = 4085.672345 (without initial connection time)
```

**–í–∞–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- **TPS** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **latency average/stddev** ‚Äî —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∏ –µ—ë –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
- **connection time** ‚Äî –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ TPS –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

---

### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ç–µ—Å—Ç—ã –Ω–∞ ¬´—Ç—ë–ø–ª–æ–º¬ª –∫—ç—à–µ (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ–≤)
   - –û—Ç–∫–ª—é—á–∞–π—Ç–µ —Ñ–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Å—à—Ç–∞–±–∞:**
   - `-s 1` ‚âà 100k —Å—Ç—Ä–æ–∫ –≤ `pgbench_accounts`
   - –î–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `-s` —Ç–∞–∫–æ–π, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–º–µ—â–∞–ª–∏—Å—å –≤ `shared_buffers`

3. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏:**
   ```bash
   for clients in 4 8 16 32 64; do
     pgbench -c $clients -j 4 -T 60 -P 10 mydb
   done
   ```

4. **–ê–Ω–∞–ª–∏–∑ —É–∑–∫–∏—Ö –º–µ—Å—Ç:**
   - –°–ª–µ–¥–∏—Ç–µ –∑–∞ `latency stddev` ‚Äî –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `-r` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CPU, I/O, –ø–∞–º—è—Ç—å) –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ç–µ—Å—Ç–æ–º

5. **–í–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
   - –ù–∞—á–∏–Ω–∞—è —Å PostgreSQL 14, pgbench –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `FREEZE` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ `VACUUM` 
   - –í PostgreSQL 17 —É–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å VACUUM –∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, —á—Ç–æ –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ 

---

### ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —É–ø—Ä–æ—â—ë–Ω –∏ –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–ª–æ–∂–Ω—ã–µ JOIN, –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
- –î–ª—è production-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã, –æ—Ç—Ä–∞–∂–∞—é—â–∏–µ —Ä–µ–∞–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã

–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å pgbench —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `pg_stat_statements`, `EXPLAIN ANALYZE`, —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã `iostat`, `vmstat`).
